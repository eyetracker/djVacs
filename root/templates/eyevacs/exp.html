{% extends 'base.html' %}
{% load staticfiles %}
{# {% load i18n %} #}
{% block body %}
{# ######################################################################## #}
{# ######################################################################## #}
<b> Experiment</b><br/>
----------------------------------------------------------------------------------------------------
<p style="background:#6cf; color:#555; line-height:150%;vertical-align:middle; font-size:24px; width:1000px; font-weight:bold; margin:0;">&nbsp;{{exp.name }}&nbsp;</p>
----------------------------------------------------------------------------------------------------<br/>
<table>
    <tr>
        <td style="vertical-align:top;">
# Comepleted participants: {{exp.participant_set.count}}<br/>
----------------------------------<br/>
# Total data files: {{exp.external_source_data_set.count }}<br/>
{# {% for file in exp.external_source_data_set.all %} #}
{#    -- {{file.filetype}}: header: {{file.header}}<br/> #}
{# {%endfor %} #}
----------------------------------<br/>
<br/>
<form action="{{ destination }}"  method="post" name="experience_settings" id="exp_form_id" >
{% csrf_token %}
<div>
    <b>Participant task size:</b>
    (Default value is: )
    {%for size in tasksize %}
        {%if size.checked == "checked" %}
            {{size.label}}
        {%endif%}
    {%endfor %}
    {% for t in tasksize %}
        <label class="lbadmin" ><input type="radio" name="ct_size" value={{t.value}} {{t.checked}} /> {{t.label}}</label>
        {% endfor %}
</div>
<br/>
<div>
    <b>Default next participant ID: {{pcpt_id}}</b><br/>
    <b>Default next condition: {{ next_condition }}</b><br/>
    <br/>
Enter ID manually: <br/>
<input type="text" value="{{ pcpt_id }}" name="input_pcptid" /> (dont change for next default ID = <b>{{pcpt_id}}</b> )
</div>
<br/>
<br/>
</td>

{# 2nd column, RIGHT #}
{# ######################################################################## #}
<td style="width:100px;">
{# spacer #}
</td>
{# ######################################################################## #}

<td style="border:1px solid #6cf; padding:25px; padding-top:5px; padding-bottom:25px;">
<br/>
<p style="background:#6cf; color:#555;"><b>Options override:</b></p>
<p>Enable form validation?</p>
<label class="lbadmin" style="width:250px;text-align:left;"><input type="checkbox" name="cbox_validation" checked >Validate user input?</label>
<p>Jump to Page:</p>
<label class="lbadmin" style="width:250px;text-align:left;"><input type="checkbox" name="cbox_singlepagedebug" >
Show page list</label>
<p>Select the "Welcome Page"</p>
<div style="text-indent:35px;">
<select name="selectwelcome" style="width:200px;">
    <option value="welcome_scrollable">All in one page (scrollable)</option>
    {# <option value="welcome_paginated">Seperate pages</option> #}
</select>
</div>
<p>Select Condition</p>
<div style="text-indent:35px;">
<select name="selectcondition" style="width:200px;">
    <option value="increasing">Increasing</option>
    <option value="decreasing">Decreasing</option>
    {# <option value="basetwo">Baseline 2 Tasks</option> #}
    {# <option value="baseeight">Baseline 8 Tasks</option> #}
</select>
</div>
<p>Select Language</p>
<div style="text-indent:35px;">
<select id="lang" name="selectlanguage" style="width:200px;">
    <option value="en">English</option>
    <option value="de">Deutsch</option>
</select>
<div id="lang_picture" style="height:50px;margin-top:20px;"></div>
</div>
</td>
</tr>
</table>
{# ######################################################################## #}
{# ######################################################################## #}

<script>
    $(document).ready(function(){
        var current_language = $("#lang").val();
        var de_flag = '<img src="{% static "img/de.jpg" %}" style="height:50px;" >';
        var en_flag = '<img src="{% static "img/en.jpg" %}" style="height:50px;" >';
        function showflag(language){
            if (language == 'en') {
                $("#lang_picture img").remove();
                $("#lang_picture").append(en_flag);
                }
            else if (language == 'de') {
                $("#lang_picture img").remove();
                $("#lang_picture").append(de_flag);
                };
        };
        showflag(current_language);
        $("#lang").change(function(){
            var current_language = $("#lang").val();
            showflag(current_language);
            });
        });
</script>

<br/>
<br/>
<input type="submit" value="New Participant" class="bt_new_pcpt" />
</form>

{# Form validation #}

{# {% if DEBUG %} <div id="allErrors"></div> {% endif %} #}
<div id="allErrors"></div>
<br/>
<div style="margin-left:auto; margin-right:auto;width:500px;">
<div id="errorField" style="display:none" ></div>
<br/>
</div>

<script>
    $(document).ready(function(){
        var maxID = 899;
        var thisform = $('form');
        var validator = thisform.validate({
        {# var validator = thisform.validate({ #}
            {# turn off debug to truly submit! #}
            debug: true,
            rules: {
                ct_size:{
                    required: true
                    } ,
                input_pcptid: {
                    required: true,
                    max: (maxID)
                    }
                },
            {# only executed on form submit!!! hiding of off error #}
            {# has to be solved with another funtion, eg: errorContainer #}
            invalidHandler: function(thisform, validator) {
                var errors = validator.numberOfInvalids();
                if (errors) {
                $("#errorField").text('There is ' + errors + ' error in this form!');
                $("#errorField").show();
                  } else {
                $("#errorField").hide();
                  }
              },
            messages: {
                ct_size: "You did not select the choice task size!",
                input_pcptid: "Enter a valid ID for a participant (maximum: "+ (maxID)+" )"
            },
                errorClass: "admin_error",
{# invalid #}
            {# error destination id #}
            errorLabelContainer: "#allErrors",
            errorContainer: "#errorField",            
            {# wraps EVERY error inside wrapper: #}
            wrapper: "ul", 
            success: "valid",
            errorElement: "err_elem",
            {# debug only #}
            submitHandler: function(thisform) { 
                {# experience_settings.submit(); #}
                thisform.submit();
            }
        });
    });
  </script>


{% endblock %}
